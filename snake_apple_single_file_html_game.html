<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake & Apple</title>
  <style>
    :root {
      --bg: #0b1021;
      --panel: #121937;
      --text: #e8ebff;
      --accent: #8bff66;
      --accent-2: #6aa3ff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100svh;
      background: radial-gradient(80% 60% at 50% 0%, #18224c 0%, var(--bg) 70%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .wrap {
      width: min(92vw, 520px);
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      overflow: hidden;
    }
    header, footer {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 14px;
      background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0));
    }
    header h1 { font-size: 18px; margin: 0; letter-spacing: 0.4px; }
    header .score { font-variant-numeric: tabular-nums; }

    #board {
      display: block;
      width: 100%;
      height: auto;
      background: repeating-linear-gradient(45deg, #0e1533, #0e1533 10px, #0c1230 10px, #0c1230 20px);
      image-rendering: pixelated;
    }

    footer { gap: 8px; flex-wrap: wrap; }
    .btn {
      background: #1a2457;
      border: 1px solid rgba(255,255,255,0.15);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 14px;
      cursor: pointer;
      transition: transform .08s ease;
    }
    .btn:active { transform: scale(0.98); }
    .hint { opacity: .8; font-size: 12px; }

    .dpad {
      display: grid; grid-template-columns: repeat(3, 44px); grid-template-rows: repeat(3, 44px);
      gap: 6px; align-items: center; justify-items: center;
    }
    .dpad .padbtn { width: 44px; height: 44px; border-radius: 10px; border: 1px solid rgba(255,255,255,.2); background:#213074; color: #fff; font-weight: 700; }
    .dpad .padbtn:active { transform: scale(0.98); }
    .grow { flex: 1 1 auto; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>üêç Snake & Apple</h1>
        <div class="score">Score: <span id="score">0</span></div>
      </header>
      <canvas id="board" width="480" height="480" aria-label="Snake game board" role="img"></canvas>
      <footer>
        <div class="hint">Controls: ‚¨ÖÔ∏è‚¨ÜÔ∏è‚¨áÔ∏è‚û°Ô∏è / WASD ¬∑ Space = Pause ¬∑ R = Restart</div>
        <div class="grow"></div>
        <button id="pauseBtn" class="btn" title="Pause (Space)">Pause</button>
        <button id="restartBtn" class="btn" title="Restart (R)">Restart</button>
      </footer>
      <footer style="gap:14px; align-items:center;">
        <div class="hint">Touch controls</div>
        <div class="dpad" aria-hidden="true">
          <span></span><button class="padbtn" data-dir="up">‚ñ≤</button><span></span>
          <button class="padbtn" data-dir="left">‚óÄ</button><span></span><button class="padbtn" data-dir="right">‚ñ∂</button>
          <span></span><button class="padbtn" data-dir="down">‚ñº</button><span></span>
        </div>
      </footer>
    </div>
  </div>

  <script>
    // --- Game config ---
    const GRID = 24;
    const CELL = 20;
    let TICK_MS = 150;          // start at a moderate speed
    const SPEEDUP_STEP = 5;     // reduce interval by this many ms each apple
    const MIN_TICK = 60;        // minimum speed limit

    // --- Canvas setup ---
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');
    canvas.width = GRID * CELL;
    canvas.height = GRID * CELL;

    // --- Game state ---
    let snake, dir, nextDir, apple, score, timer, running, justAte;

    function init() {
      snake = [
        {x: 8, y: 12},
        {x: 7, y: 12},
        {x: 6, y: 12}
      ];
      dir = {x: 1, y: 0};
      nextDir = {...dir};
      score = 0;
      justAte = false;
      document.getElementById('score').textContent = score;
      apple = spawnApple();
      running = true;
      TICK_MS = 150; // reset to moderate speed on restart
      clearInterval(timer);
      timer = setInterval(loop, TICK_MS);
      draw();
    }

    function spawnApple() {
      let pos;
      do {
        pos = { x: Math.floor(Math.random() * GRID), y: Math.floor(Math.random() * GRID) };
      } while (snake.some(s => s.x === pos.x && s.y === pos.y));
      return pos;
    }

    function loop() {
      if (!running) return;
      dir = nextDir;
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
      head.x = (head.x + GRID) % GRID;
      head.y = (head.y + GRID) % GRID;

      if (snake.some((s, i) => i && s.x === head.x && s.y === head.y)) {
        gameOver();
        return;
      }

      snake.unshift(head);

      if (head.x === apple.x && head.y === apple.y) {
        score++;
        document.getElementById('score').textContent = score;
        apple = spawnApple();
        justAte = true;
        // speed up slightly when eating apple
        TICK_MS = Math.max(MIN_TICK, TICK_MS - SPEEDUP_STEP);
        clearInterval(timer);
        timer = setInterval(loop, TICK_MS);
      }

      if (!justAte) snake.pop();
      justAte = false;
      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.globalAlpha = 0.08;
      ctx.fillStyle = '#ffffff';
      for (let y = 0; y < GRID; y++) {
        for (let x = 0; x < GRID; x++) {
          if ((x + y) % 2 === 0) ctx.fillRect(x*CELL, y*CELL, CELL, CELL);
        }
      }
      ctx.globalAlpha = 1;

      ctx.fillStyle = '#ff5964';
      roundedRect(ctx, apple.x*CELL+3, apple.y*CELL+3, CELL-6, CELL-6, 4);
      ctx.fill();
      ctx.fillStyle = '#80ff72';
      ctx.beginPath();
      ctx.ellipse(apple.x*CELL + CELL*0.7, apple.y*CELL + CELL*0.35, 3, 6, 0.5, 0, Math.PI*2);
      ctx.fill();

      for (let i = 0; i < snake.length; i++) {
        const s = snake[i];
        const hue = 140 + i * 0.6;
        ctx.fillStyle = `hsl(${hue} 80% 45%)`;
        roundedRect(ctx, s.x*CELL+2, s.y*CELL+2, CELL-4, CELL-4, 6);
        ctx.fill();
      }

      const h = snake[0];
      ctx.fillStyle = '#081218';
      const eye = 3;
      ctx.beginPath();
      ctx.arc(h.x*CELL + CELL*0.35, h.y*CELL + CELL*0.35, eye, 0, Math.PI*2);
      ctx.arc(h.x*CELL + CELL*0.65, h.y*CELL + CELL*0.35, eye, 0, Math.PI*2);
      ctx.fill();
    }

    function roundedRect(ctx, x, y, w, h, r) {
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    function gameOver() {
      running = false;
      clearInterval(timer);
      ctx.save();
      ctx.fillStyle = 'rgba(0,0,0,.5)';
      ctx.fillRect(0,0,canvas.width, canvas.height);
      ctx.fillStyle = '#ffffff';
      ctx.textAlign = 'center';
      ctx.font = '700 28px system-ui, sans-serif';
      ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 8);
      ctx.font = '500 16px system-ui, sans-serif';
      ctx.fillText('Press R to restart', canvas.width/2, canvas.height/2 + 18);
      ctx.restore();
    }

    const KEYS = {
      ArrowUp: {x:0,y:-1}, KeyW: {x:0,y:-1},
      ArrowDown:{x:0,y:1}, KeyS:{x:0,y:1},
      ArrowLeft:{x:-1,y:0}, KeyA:{x:-1,y:0},
      ArrowRight:{x:1,y:0}, KeyD:{x:1,y:0}
    };
    function setDirection(vec) {
      if (vec.x === -dir.x && vec.y === -dir.y) return;
      nextDir = vec;
    }

    addEventListener('keydown', (e) => {
      if (KEYS[e.code]) {
        e.preventDefault();
        setDirection(KEYS[e.code]);
      } else if (e.code === 'Space') {
        togglePause();
      } else if (e.code === 'KeyR') {
        init();
      }
    }, { passive: false });

    document.getElementById('pauseBtn').onclick = togglePause;
    document.getElementById('restartBtn').onclick = init;
    document.querySelectorAll('.padbtn').forEach(b => {
      b.addEventListener('click', () => {
        const d = b.dataset.dir;
        const map = { up:{x:0,y:-1}, down:{x:0,y:1}, left:{x:-1,y:0}, right:{x:1,y:0} };
        setDirection(map[d]);
      })
    });

    function togglePause() {
      running = !running;
      if (running) {
        clearInterval(timer);
        timer = setInterval(loop, TICK_MS);
      }
    }

    init();
  </script>
</body>
</html>
